<Project Sdk="Microsoft.Build.Traversal">
    <PropertyGroup>
    	<!-- we always want to make shared libs -->
        <NativeLibKind Condition="'$(NativeLibKind)' == ''">shared</NativeLibKind>

	<!-- When we publish, we want to ensure the SDK does the same thing as though we ran 'dotnet publish' -->
	<TraversalPublishGlobalProperties>$(TraversalPublishGlobalProperties);_IsPublishing=true</TraversalPublishGlobalProperties>
    </PropertyGroup>

    <ItemGroup>
        <!-- add new projects here -->
        <!-- NativeLibsProjectsToBuild Include="$(MSBuildThisFileDirectory)libhellomanaged/src/libhellomanaged.csproj" -->
        <NativeLibsProjectsToBuild Include="$(MSBuildThisFileDirectory)cdacreader/src/cdacreader.csproj" />
    </ItemGroup>

    <ItemGroup>
        <!-- additional native compilation-specific properties to pass down to the ProjectReference -->
        <SubprojectProps Include="NativeLib" Value="$(NativeLibKind)"/>
    </ItemGroup>

    <Import Project=".\subproject.props" />

    <ItemGroup>
        <ProjectReference Include="@(NativeLibsProjectsToBuild)"
                          ReferenceOutputAssembly="false"
                          AdditionalProperties="%(AdditionalProperties);$(SplitSubprojectProps)"
                          Targets="Publish"
                          Condition="$(UseNativeAotForComponents) and '$(RuntimeFlavor)' != 'Mono'"/>
    </ItemGroup>
</Project>
